<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cars</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
</head>

<body>
  
  <%- include('./partials/header.ejs')%>

    <div class="row m-0 pt-4 px-2">
      <% if(cars && cars.length !==0) { %>
        <% cars.forEach(car=> { %>
          <div class="col-sm-11 my-3 col-md-4 ">
            <div class="card">
              <div class="card-header">
                <h4>
                  <%= car.model %>
                </h4>
              </div>
              <div class="card-body">
                <% if(isAdmin) { %>
                  <label class="small text-secondary mt-3" for="model">Model: </label>
                  <input type="text" class="form-control" id="model" value="<%= car.model %>"
                    placeholder="Update model">
                  <label class="small text-secondary" for="desc">Description: </label>
                  <textarea id="desc" cols="30" rows="2" class="form-control"
                    placeholder="Update description"><%= car.description %></textarea>
                  <label class="small text-secondary mt-3" for="brand">Brand: </label>
                  <input type="text" class="form-control" value="<%= car.brand %>" id="brand"
                    placeholder="Update brand">
                  <label class="small text-secondary mt-3" for="price">price: </label>
                  <input type="number" class="form-control" value="<%= car.price %>" id="price"
                    placeholder="Update price">
                  <!-- <%= car.description %> -->
                  <% } else { %>
                    <div class="border p-2 ">
                      <p class="fw-bold">Description: </p>
                      <%= car.description %>
                    </div>
                    <div class="mt-3 border p-2 ">
                      <p class="fw-bold">Brand: </p>
                      <%= car.brand %>
                    </div>
                    <div class="mt-3 border p-2 ">
                      <p class="fw-bold">Price: </p>
                      <%= car.price %>
                    </div>
                    <% } %>
              </div>
              <div class="card-footer">
                <a href="/cars/<%= car.id %>" class="btn btn-outline-primary">view</a>
                <button class="btn btn-outline-danger" onclick="deleteCar(`<%= car.id %>`)">delete</button>
                <% if(isAdmin) { %>
                  <button class="btn btn-outline-success" onclick="update(`<%= car.id %>`,this)">Update</button>
                  <% } %>
              </div>
            </div>
          </div>
          <% }) %>
            <% } else { %>
              <h1>there is no car</h1>
              <% } %>
    </div>

    <script>
      if (!localStorage.getItem('token')) {
        window.location.pathname = '/sign-in';
      } else {

      }
      function deleteCar(id) {
        fetch(`http://localhost:3000/cars/${id}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            'x-auth-token': localStorage.getItem('token')
          }
        })
          .then(res => res.json())
          .then(data => window.location.reload())
          .catch(err => console.error("ERROR: ", err))
      }
      function getValue(name) {
        return document.getElementById(name).value;
      }
      function update(id, inputs) {
        const formElements = inputs.parentElement.parentElement.children[1].children;
        fetch(`http://localhost:3000/cars/${id}`, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json',
            'x-auth-token': localStorage.getItem('token')
          },
          body: JSON.stringify({
            model: formElements[1].value,
            description: formElements[3].value,
            brand: formElements[5].value,
            price: formElements[7].value
          })
        })
          .then(res => res.json())
          .then(data => window.location.reload())
          .catch(err => console.error("ERROR: ", err))
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
      crossorigin="anonymous"></script>
</body>

</html>